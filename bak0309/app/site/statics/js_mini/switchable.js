var AutoPlay=new Class({options:{autoplay:true,interval:5000,pauseOnHover:true},_autoInit:function(a){if(!this.options.autoplay){return}this.autofn=a||function(){};this.autoEvent().startAutoplay()},autoEvent:function(){if(this.options.pauseOnHover&&this.container){this.container.addEvents({mouseenter:this.stopAutoplay.bind(this),mouseleave:function(){this.startAutoplay()}.bind(this)})}return this},startAutoplay:function(){this.paused=false;this.autoTimer=function(){if(this.paused){return}this.autofn()}.periodical(this.options.interval,this)},stopAutoplay:function(){if(this.autoTimer){clearInterval(this.autoTimer);this.autoTimer=undefined}this.paused=true}});var LazyLoad=new Class({Implements:[Options,Events],options:{img:"data-src",textarea:"action-lazyload",lazyDataType:"textarea",execScript:true,islazyload:true,lazyEventType:"beforeSwitch",onAfter:function(){}},loadCustomLazyData:function(e,b){var c,f,a=this.options.textarea,d=this.options.img;if(!this.options.islazyload){return}Array.from(e).each(function(g){switch(b){case"img":f=g.nodeName==="IMG"?[g]:g.getElements("img");f.each(function(h){this.loadImgSrc(h,d)},this);break;default:c=g.getElement("textarea");if(c&&c.hasClass(a)){this.loadAreaData(c)}break}},this)},loadImgSrc:function(c,b,a){b=b||this.options.img;var d=c.getProperty(b);c.removeProperty(b);if(d&&c.src!=d){imageReady(d,function(){c.src=d;a&&a()},function(){this.fireEvent("after",c)}.bind(this))}},loadAreaData:function(c,a){var b=new Element("div").inject(c,"before");this.stripScripts(c.value,b);c.destroy();a&&a()},isAllDone:function(){var f=this.options.lazyDataType,b=this.options[f],d,e,a,c=f==="img";if(f&&this.container){d=this.container.getElements(f);for(e=0,a=d.length;e<a;e++){if(c?d[e].get(b):d[e].hasClass(b)){return false}}}return true},stripScripts:function(b,c){var a="";var d=b.replace(/<script[^>]*>([\s\S]*?)<\/script>/gi,function(){a+=arguments[1]+"\n";return""});c.set("html",this.options.execScript?d:b);this.options.execScript&&Browser.exec(a)},_lazyloadInit:function(a){var b=function(){var c=typeOf(a)=="function"?a(arguments):a;this.loadCustomLazyData(c,this.options.lazyDataType);if(this.isAllDone()){this.removeEvent(this.options.lazyEventType,arguments.callee)}};this.addEvent(this.options.lazyEventType,b.bind(this))}});var DataLazyLoad=new Class({Extends:LazyLoad,options:{containers:document,threshold:null,syncEl:null,config:{mod:"manual",diff:"default",placeholder:""}},initialize:function(a,b){this.setOptions(a);b=b||this.options.containers;this.containers=Array.from(b);if(!this.containers.length){return}if(window.Shop){this.options.config.placeholder=Shop.url.placeholder}this.lazyinit()},lazyinit:function(){this.threshold=this.getThreshold();this.filterItems().getItemsLength();this.initLoadEvent()},filterItems:function(){var c=this.containers,g,a,e,h,f,b,j=[],d=[];c.each(function(i){j=j.combine(i.getElements("img").filter(this.filterImg,this));d=d.combine(i.getElements("textarea").filter(this.filterArea,this))},this);this.images=j;this.areas=d;return this},filterImg:function(b){var e=this.options.img,c=b.getAttribute(e),a=this.threshold,f=this.options.config.placeholder,d=this.options.config.mod==="manual";if(d){if(c){if(f){b.src=f}return true}}else{if($(b).getOffsets().y>a&&!c){b.set(e,b.src);f?b.src=f:b.removeAttribute("src");return true}}},filterArea:function(a){return a.hasClass(this.options.textarea)},initLoadEvent:function(){var e,c=this,d=window;d.addEvent("domready",this.loadItems.bind(this));if(!this.getItemsLength()){return}d.addEvents({scroll:a,resize:b});function b(){c.threshold=c.getThreshold();a()}function a(){if(e){return}e=function(){c.loadItems.call(c);if(!c.getItemsLength()){d.removeEvents({scroll:a,resize:b})}e=null}.delay(100)}},loadItems:function(){var a=this.options.syncEl;if(a){return this.loadsync(this[a],a)}this.initItems(this.images.concat(this.areas));this.fireEvent("callback")},initItems:function(c){var e=window.getScroll().y,b=this.threshold+e,d={images:[],areas:[]},a={areas:"loadAreaData",images:"loadImgSrc"};c.each(function(f){var h=f.tagName=="TEXTAREA"?"areas":"images",g=$(f);if(h){if(g.getStyle("display")=="none"){f=g.getParent()}else{f=g}}if(g.getOffsets().y<=b){this[a[h]](g)}else{d[h].push(g)}},this);this.images=d.images;this.areas=d.areas},loadsync:function(c,b){if(!c.length){return}var f=window.getScroll().y,a=this.threshold+f,e=b=="areas";c=c.filter(function(h){if(e){h=h.getStyle("display")=="none"?h.parentNode:h}return h.getOffsets().y<=a});if(!c.length){return}var d=c.shift(),g=this.loadsync.bind(this,[this[b].erase(d),b]);if(e){return this.loadAreaData(d,g)}this.loadImgSrc(d,false,g)},getThreshold:function(){if(this.options.threshold){return this.options.threshold}var a=this.options.config.diff,b=window.getSize().y;if(a==="default"){return 1*b}return b+a},getItemsLength:function(){return this.images.length+this.areas.length}});var Tabs=new Class({Implements:[AutoPlay,LazyLoad],options:{eventType:"mouse",hasTriggers:true,triggersBox:".switchable-triggerBox",triggers:".switchable-trigger",content:".switchable-content",panels:".switchable-panel",activeIndex:0,activeClass:"active",steps:1,delay:100,haslrbtn:false,prev:".prev",next:".next",autoplay:false,disableCls:null},initialize:function(a,b){this.container=$(a);if(!this.container){return}this.setOptions(b);this.activeIndex=this.options.activeIndex;this.init()},init:function(){this.fireEvent("load");this.getMarkup();this.triggersEvent().extendPlugins();if(this.options.hasTriggers&&this.triggers[this.activeIndex]){this.triggers[this.activeIndex].addClass(this.options.activeClass)}if(this.options.showClass&&this.panels[this.activeIndex]){this.panels[this.activeIndex].addClass(this.options.showClass)}if(this.options.islazyload){this.fireEvent("beforeSwitch",{toIndex:this.activeIndex})}this.fireEvent("init")},extendPlugins:function(){var a=this.options;if(a.autoplay){this._autoInit(this.autofn.bind(this))}if(a.islazyload){this._lazyloadInit(this.getLazyPanel.bind(this))}Tabs.plugins.each(function(b){if(b.init){b.init.call(this)}},this)},autofn:function(){var a=this.activeIndex<this.length-1?this.activeIndex+1:0;this.switchTo(a,"FORWARD")},getMarkup:function(){var a=this.container,b=this.options,c;if(b.hasTriggers){c=$(b.triggersBox)||a.getElement(b.triggersBox)}this.triggers=c?c.getChildren():a.getElements(b.triggers);panels=this.panels=a.getElements(b.panels);this.content=$(b.content)||a.getElement(b.content)?a.getElement(b.content):panels[0]?panels[0].getParent():[];this.content=Array.from(this.content);if(!panels.length&&this.content.length){this.panels=this.content[0].getChildren()}if(!this.panels.length){return this}this.activeIndex=this.activeIndex.limit(0,this.panels.length-1);this.length=this.panels.length/b.steps},triggersEvent:function(){var a=this.options,b=this.triggers;if(a.hasTriggers){b.each(function(d,c){d.addEvent("click",function(f){if(this.options.stopEvent){f.stop()}if(!this.triggerIsValid(c)){return}this.cancelTimer().switchTo(c)}.bind(this));if(a.eventType==="mouse"){d.addEvents({mouseenter:function(f){if(!this.triggerIsValid(c)){return}this.switchTimer=this.switchTo.delay(a.delay,this,c)}.bind(this),mouseleave:this.cancelTimer.bind(this)})}},this)}if(a.haslrbtn){this.lrbtn()}return this},lrbtn:function(){var a=this;["prev","next"].each(function(b){this[b+"btn"]=this.container.getElements(this.options[b]).addEvent("click",function(c){if(!this.hasClass(a.options.disableCls)){a[b]()}})},this);this.disabledBtn()},disabledBtn:function(){var a=this.options.disableCls;if(a){this.addEvent("switch",function(d){var b=d.currentIndex,c=(b===0)?this["prevbtn"]:(b===Math.ceil(this.length)-1)?this["nextbtn"]:undefined;this["nextbtn"].removeClass(a);this["prevbtn"].removeClass(a);if(c){c.addClass(a)}}.bind(this))}},triggerIsValid:function(a){return this.activeIndex!==a},cancelTimer:function(){if(this.switchTimer){clearTimeout(this.switchTimer);this.switchTimer=undefined}return this},switchTo:function(b,f){var i=this.options,d=this.triggers,c=this.panels,h=this.activeIndex,e=i.steps,g=h*e,a=b*e;if(!this.triggerIsValid(b)){return this}this.fireEvent("beforeSwitch",{toIndex:b});if(i.hasTriggers){this.switchTrigger(h>-1?d[h]:null,d[b])}if(f===undefined){f=b>h?"FORWARD":"BACKWARD"}this.switchView(c.slice(g,g+e),c.slice(a,a+e),b,f);this.activeIndex=b;return this.fireEvent("switch",{currentIndex:b})},switchTrigger:function(d,a,b){var c=this.options.activeClass;d&&d.removeClass(c);a&&a.addClass(c)},switchView:function(e,d,b,c){var a=this.options.showClass;if(a){e[0].removeClass(a);d[0].addClass(a)}e[0].setStyle("display","none");d[0].setStyle("display","")},prev:function(){var a=this.activeIndex;this.switchTo(a>0?a-1:this.length-1,"BACKWARD")},next:function(){var a=this.activeIndex;this.switchTo(a<this.length-1?a+1:0,"FORWARD")},getLazyPanel:function(b){var a=this.options.steps,d=b[0].toIndex*a,c=d+a;return this.panels.slice(d,c)}});Tabs.plugins=[];Tabs.Effects={none:function(b,a){b[0].setStyle("display","none");a[0].setStyle("display","block")},fade:function(d,a){if(d.length!==1){throw new Error("fade effect only supports steps == 1.")}var c=d[0],b=a[0];if(this.anim){this.anim.cancel()}this.anim=new Fx.Tween(c,{duration:this.options.duration,onStart:function(){b.setStyle("opacity",1)},onCancel:function(){this.element.setOpacity(0);this.fireEvent("complete")},onComplete:function(){b.setStyle("zIndex",2);c.setStyle("zIndex",1);this.anim=undefined}.bind(this)}).start("opacity",1,0)},scroll:function(l,k,f,r){var j=this,d=this.options,o=this.activeIndex,g=d.effect==="scrollx",q=this.length,n=this.content[0],e=this.viewSize[g?0:1],p=d.steps,c=this.panels,b=g?"left":"top",i=-e*f,m,h,a=r!=="FORWARD";b=n.getStyle("position")=="absolute"?b:"margin-"+b;h=(a&&o===0&&f===q-1)||(!a&&o===q-1&&f===0);if(h){i=s.call(this,true)}fromp=n.getStyle(b).toInt();fromp=isNaN(fromp)?0:fromp;if(this.anim){this.anim.cancel()}this.anim=new Fx.Tween(n,{duration:this.options.duration,transition:this.options.transition,onComplete:function(){if(h){s.call(j)}this.anim=undefined}.bind(this)}).start(b,fromp,i);function s(v){var y=a?q-1:0,x=y*p,w=(y+1)*p,u;for(u=x;u<w;u++){var t=(a?-1:1)*e*q;c[u].setStyle("position",v?"relative":"").setStyle(b,v?t:"")}if(v){return a?e:-e*q}return n.setStyle(b,a?-e*(q-1):"")}}};Effects=Tabs.Effects;Effects.scrollx=Effects.scrolly=Effects.scroll;var Switchable=new Class({Extends:Tabs,options:{autoplay:true,position:"absolute",isFloat:true,effect:"none",circular:false,duration:500,transition:Fx.Transitions.linear,direction:"FORWARD",viewSize:[]},extendPlugins:function(){this.parent();this.effInit()},effInit:function(){var k=this.options,j=k.effect,d=this.panels,c=this.content[0],f=k.steps,g=k.viewStep,h=this.activeIndex,b=d.length;size=d[0].measure(function(){return{x:this.getSize().x?this.getSize().x+this.getPatch("margin").x:this.getStyle("width").toInt()+this.getPatch().x,y:this.getSize().y?this.getSize().y+this.getPatch("margin").y:this.getStyle("height").toInt()+this.getPatch().y}});this.viewSize=[k.viewSize[0]||size.x*f,k.viewSize[1]||size.y*f];if(j!=="none"){switch(j){case"scrollx":case"scrolly":if(k.position=="absolute"){c.setStyle("position","absolute");c.getParent().setStyles({position:"relative"})}else{if(k.position=="relative"){c.setStyle("position","relative")}}if(j==="scrollx"){k.isFloat&&d.setStyle("float","left");c.setStyle("width",this.viewSize[0]*(b/f))}break;case"fade":var a=h*f,e=a+f-1,i;d.each(function(l,m){i=m>=a&&m<=e;l.setStyles({opacity:i?1:0,position:k.position||"",zIndex:i?2:1})});break;default:break}}},switchView:function(h,a,c,g){var b=this.options,f=b.effect,e=b.circular,d=typeOf(f)=="function"?f:Effects[f];if(e){g=b.direction}if(d){d.call(this,h,a,c,g)}}});var Accordion=new Class({Extends:Tabs,options:{eventType:"click",multiple:false},triggerIsValid:function(a){return this.activeIndex!==a||this.options.multiple},switchView:function(e,d,c){var b=this.options,a=d[0];if(b.multiple){this.triggers[c].toggleClass(b.activeClass);a.setStyle("display",a.getStyle("display")=="none"?"block":"none")}else{e[0].setStyle("display","none");a.setStyle("display","block")}}});var Slide=new Class({Extends:Switchable,options:{viewStep:4},effect:function(m,l,f,t){var k=this,d=this.options,p=this.activeIndex,h=d.effect==="scrollx",r=this.length,o=this.content[0],e=this.viewSize[h?0:1],q=d.steps,c=this.panels,b=h?"left":"top",j=-e*f,n,i,a=t!=="FORWARD";i=(a&&p===0&&f===r-1)||(!a&&p===r-1&&f===0);if(i){j=v.call(this,true)}fromp=o.getStyle(b).toInt();fromp=isNaN(fromp)?0:fromp;if(this.anim){return this}var s=[],u=d.viewStep,g=u-q;this.anim=new Fx.Tween(o,{duration:this.options.duration,transition:this.options.transition,onStart:function(){this.to[0].value=a?e:-e;if(!a){var w=f,x;for(var y=u-1;y>=0;y--){w++;if(w>r){if(!x){x=u-y}s.push(y);c[y].setStyle(b,x*e)}}if(!f){c[g].setStyle(b,e);c[0].setStyle(b,e)}}},onComplete:function(){o.setStyle(b,0);c.each(function(z,y){var w=!f?0:-e*f,x=f+u-r;if(a&&y<x){w=-e*(f-r)}if(!a&&s.contains(y)){w=e*(g-s[0])}z.setStyle("position","relative").setStyle(b,w)});this.anim=undefined}.bind(this)}).start(b,fromp,j);function v(y){var B=a?r-1:0,A=B*q,z=(B+1)*q,x;for(x=A;x<z;x++){var w=(a?-1:1)*e*r;c[x].setStyle("position",y?"relative":"").setStyle(b,y?w:"")}if(y){return a?e:-e*r}return o.setStyle(b,a?-e*(r-1):"")}},switchView:function(f,a,c,e){var b=this.options,d=b.circular;if(d){e=b.direction}this.effect(f,a,c,e)}});var DropMenu=new Class({Implements:[Events,Options,LazyLoad],options:{onLoad:function(){},onShow:function(){},onHide:function(){},showMode:function(a){a.setStyle("display","block").fade(1)},hideMode:function(a){a.setStyle("display","none").fade(0)},dropClass:"active",eventType:"mouse",relative:null,stopEl:false,stopState:false,lazyEventType:"show",delay:200,offset:{x:0,y:20}},initialize:function(b,a){this.element=$(b);if(!this.element){return}this.setOptions(a);var c=this.options.menu||this.element.get("dropmenu");this.menu=$(c)||this.element.getParent().getElement("."+c);if(!this.menu){return}this.load().attach()._lazyloadInit(this.menu)},attach:function(){var a=this.options,d=a.stopState,c=a.dropClass,b=a.eventType;if(b=="mouse"){$$(this.element,this.menu).addEvents({mouseenter:function(f){this.show();if(this.timer){clearTimeout(this.timer)}}.bind(this),mouseleave:function(){if(!this.status){return}this.timer=this.hide.delay(this.options.delay,this)}.bind(this)})}else{this.element.addEvent(b,function(f){if(this.showTimer){clearTimeout(this.showTimer)}if(d){f.stop()}this.showTimer=this.show().outMenu.delay(this.options.delay,this)}.bind(this))}this.menu.addEvent("click",function(f){if(true===a.stopEl){a.stopEl="stop"}if(a.stopEl){return f[a.stopEl]()}return this.hide()}.bind(this));return this},load:function(){return this.fireEvent("load",[this.element,this])},show:function(){this.fireEvent("initShow");if(this.status){return this}this.element.addClass(this.options.dropClass);this.options.showMode.call(this,this.menu);if(this.options.relative){this.position({page:this.element.getPosition(this.options.relative)})}this.status=true;return this.fireEvent("show",this.menu)},hide:function(){this.options.hideMode.call(this,this.menu);this.element.removeClass(this.options.dropClass);this.status=false;this.fireEvent("hide",this.menu)},position:function(b){var m=this.options,a=$(m.relative),k=(a||window).getSize(),i=(a||window).getScroll();var c={x:this.menu.offsetWidth,y:this.menu.offsetHeight};if(m.temppos){var e=b.page.x+m.offset.x,j=b.page.y+this.element.getSize().y+m.offset.y;return this.menu.setStyles({top:j,left:e})}var h={x:"left",y:"top"},f={};for(var g in h){this.fireEvent("position",g);f[h[g]]=b.page[g]+this.options.offset[g]+i[g];if(f[h[g]]+c[g]-i[g]>k[g]){var d=this.options.size?this.element.getSize()[g]:0;f[h[g]]=b.page[g]-c[g]+i[g]+d+2}}this.menu.setStyles(f);return this},outMenu:function(){var a=this;document.body.addEvent("click",function(b){if(a.options.stopEl!=b.target&&a.menu){a.hide.call(a);$clear(a.showTimer);this.removeEvent("click",arguments.callee)}})}});Switchable.autoRender=function(b,d){var c=b||".auto-bind-widget";var a=$(d||document.body).getElements(c);var f=Array.from($$("img[data-src]"),$$("textarea.action-lazyload"));var e;if(f.length){e=$(document.body).get("data-lazyload-config")||"";new DataLazyLoad(JSON.decode(e))}a.length&&a.each(function(h){var g=h.get("data-widget-type");if(g&&("Tabs Switchable Slide DropMenu Accordion DataLazyLoad".indexOf(g)>-1)){try{e=h.get("data-widget-config")||"";if(g==="DataLazyLoad"){return new window[g](JSON.decode(e),h)}new window[g](h,JSON.decode(e))}catch(i){}}})};window.addEvent("domready",Switchable.autoRender.bind(Switchable));function backtotopEvent(c,b,a){if(c.attachEvent){c.attachEvent("on"+b,a)}else{c.addEventListener(b,a,false)}}backtotopEvent(window,"load",function(){var a=document.getElementById("topsidepannel");var c=document.documentElement.clientHeight;var d=null;var b;window.onscroll=function(){b=document.documentElement.scrollTop||document.body.scrollTop;if(b>=c){a.style.display="block"}else{a.style.display="none"}return b};a.onclick=function(){clearInterval(d);d=setInterval(function(){var e=b;var f=(0-e)/5;f=f>0?Math.ceil(f):Math.floor(f);if(b==0){clearInterval(d)}document.documentElement.scrollTop=b+f;document.body.scrollTop=b+f},1)}});