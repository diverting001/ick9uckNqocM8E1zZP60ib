var Widgetsinsance=new Class({Extends:DragDropPlus,initialize:function(b,c,a){this.parent(b,c,a);this.drags.each(function(d){if(d.getProperty("ishtml")){d.getElement(".content-html").set("html",d.getElement(".content-textarea").get("value"))}})},inject:function(a,b){this.addWidget(this.curEl,a,b?b:this.theme)},ghostDrop:function(a,c){this.drag_operate_box.setStyle("visibility","hidden").store("lock",true);$("tempDropBox")&&$("tempDropBox").destroy();this.tempDropBox=new Element("div",{id:"tempDropBox"}).inject(document.body);try{this.drops.each(function(g,e){if(!g){return}var h=this;var f=g.getCoordinates();if(f.height>5&&f.width>5){f.height-=5;f.width-=5}var d=new Element("div",{"class":"widgets_drop_ghost",styles:Object.merge(f,{opacity:0.3}),title:LANG_shopwidgets.dropghostTitle1+a.name+LANG_shopwidgets.dropghostTitle2}).addEvents({mouseover:function(){this.addClass("widgets_drop_ghost_on")},mouseleave:function(){this.removeClass("widgets_drop_ghost_on")},click:function(){h.tempDropBox.empty();h.addWidget(g,a,c);h.drag_operate_box.store("lock",false)}}).inject(h.tempDropBox)},this)}catch(b){alert(JSON.encode(b))}document.body.addEvent("contextmenu",function(d){d.stop();$("tempDropBox")&&$("tempDropBox").destroy();this.drag_operate_box.store("lock",false);document.body.removeEvent("contextmenu",arguments.callee)}.bind(this))},copyWidgets:function(a){},addWidget:function(a,b,d){var c={modal:true,title:LANG_shopwidgets.addWidget+(b.label||""),ajaxoptions:{render:false},width:0.7,height:0.7};this.curdialog=new top.Dialog(top.SHOPADMINDIR+"index.php?&app=site&ctl=admin_widget_proinstance&act=do_add_widgets&widgets="+b.name+"&widgets_app="+b.app+"&widgets_theme="+b.theme+"&theme="+d,c);this.curDrop=a},editWidget:function(a){var b={modal:true,title:LANG_shopwidgets.editWidget+(a.label||""),ajaksable:false,width:0.7,height:0.7};this.curWidget=$(a);return this.curdialog=new top.Dialog(top.SHOPADMINDIR+"index.php?app=site&ctl=admin_widget_proinstance&act=do_edit_widgets&widgets_id="+a.get("widgets_id")+"&theme="+a.get("widgets_theme"),b)}});window.addEvent("domready",function(){document.body.style.cssText="background:#FFFFFF!important;padding:10px 90px 0 90px!important;";this.shopWidgets=new Widgetsinsance(".shopWidgets_box",".shopWidgets_panel",{onEdit:function(b,a){shopWidgets.editWidget(b)},onDelete:function(c,b){if(!(b||confirm(LANG_shopwidgets.comfirmDel))){return}var d=this.drag_operate_box;var e=this;d.setStyle("visibility","hidden").store("lock",true);var a=c.getParent();new Fx.Tween(c).start("opacity",0).chain(function(){c.destroy();d.store("lock",false);e.checkEmptyDropPanel(a);b&&b.call(top)})},onAdd:function(b,a){a.widgetsDialog=new top.Dialog("index.php?app=site&ctl=admin_theme_widget&act=add_widgets_page&theme="+b.get("widgets_theme"),{width:770,height:500,title:"添加挂件",modal:true,resizeable:false,onShow:function(c){this.dialog_body.id="dialogContent"}})}})});