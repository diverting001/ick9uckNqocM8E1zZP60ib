var Popup=new Class({Implements:[Events,Options],options:{title:LANG_shopwidgets.tip,show:true,minHeight:220,minWidth:250,effect:{style:"opacity",duration:400,from:0,to:1,maskto:0.7},position:{target:document.body,from:{x:"center",y:"center"},to:{x:"center",y:"center"},offset:{x:0,y:0}},frameTpl:'<iframe allowtransparency="allowtransparency" align="middle" frameborder="0" height="100%" width="100%" scrolling="auto" src="about:blank">请使用支持iframe框架的浏览器。</iframe>',ajaxTpl:'<div class="loading">loading...</div>',asyncOptions:{method:"get",cache:true},component:{container:"popup-container",body:"popup-body",header:"popup-header",close:"popup-btn-close",content:"popup-content",mask:"mask"}},initialize:function(f,c){if(!f){return}this.target=f;this.doc=document.id(document.body);this.setOptions(c);c=this.options;var g=c.asyncOptions||{};var a=this.container=this.build(c.template,f);var e=new Element("div");this.body=a.getElement("."+c.component.body)||e;this.header=a.getElement("."+c.component.header)||e;this.title=this.header.getElement("h2")||e;this.close=a.getElements("."+c.component.close);this.content=a.getElement("."+c.component.content)||e;this.zIndex=maxZindex("div");if(c.width&&!isNaN(c.width)){if(c.width<=1&&c.width>0){c.width=c.width*window.getSize().x}else{c.width=c.width.toInt()}}if(c.height&&!isNaN(c.height)){if(c.height<=1&&c.height>0){c.height=c.height*window.getSize().y}else{c.height=c.height.toInt()}}this.size={x:c.width||"",y:c.height||""};c.title||(this.header.getElement("h2")&&this.header.getElement("h2").destroy());a.retrieve("instance")||this.body.setStyles({width:this.size.x,height:this.size.y});this.fireEvent("load",this);if(typeOf(f)==="string"){if(c.async==="ajax"){this.requestCache(Object.merge({url:f+"",update:this.content},g))}else{var b=g.data?f+(f.indexOf("?")>1?"&":"?")+g.data:f+"";this.content.getElement("iframe").set("src",b).addEvent("load",(g.onSuccess||function(){}).bind(this))}}if($$("div[rel=mask]."+c.component.mask)[0]){c.modal=false}if(!!c.modal){var d=!!c.effect?{style:c.effect.style,duration:c.effect.duration,from:c.effect.from,to:c.modal.opacity||c.effect.maskto}:false;this.mask=new Mask({target:c.modal.target||c.modal,"class":c.modal["class"]||c.component.mask,zIndex:this.zIndex++,effect:d})}this.hidden=true;this.attach()},attach:function(){if(this.options.show){this.show()}if(!this.container.retrieve("instance")){this.container.store("instance",this).addEvent("click:relay(."+this.options.component.close+")",function(a){this.hide()}.bind(this))}return this},build:function(c,d){var b=this.options;var e=b.id?document.id(b.id):document.getElement("[data-single=true]."+b.component.container);var a;if(typeOf(d)==="element"){a=d.tagName.test(/^(?:IMG|OBJECT|SCRIPT)$/)?d:d.innerHTML}else{if(typeOf(d)==="string"){a=b.async==="ajax"?b.ajaxTpl:b.frameTpl}}if(b.single&&e){if(typeOf(d)==="element"){e.retrieve("instance").content.innerHTML=a}return e}c='<div class="{container}" {id} data-single="'+!!b.single+'" >'+this.getTemplate(c)+"</div>";Object.merge(b.component,{title:b.title,id:b.id?'id="'+b.id+'"':"",main:a});return new Element("div",{html:c.substitute(b.component)}).getFirst().inject(this.doc)},getTemplate:function(d,c){var b=this.options;d=d||b.template;if(d&&typeOf(d)==="string"){if(!document.id(d)){return d}d=document.id(d)}if(typeOf(d)==="element"&&(/^(?:script|textarea|template)$/i).test(d.tagName)){return document.id(d).get("value")||document.id(d).get("html")}c=c||b.type;var a=['<div class="{body}">','<div class="{header}">',"<h2>{title}</h2>",'<span><button type="button" class="{close}" title="关闭"><i>×</i></button></span>',"</div>",'<div class="{content}">{main}</div>',"</div>"];if(c==="nohead"){a[1]=a[2]=a[3]=a[4]=""}else{if(c==="notitle"){a[2]=""}else{if(c==="noclose"||!!b.autoHide){a[3]=""}}}return a.join("\n")},show:function(){if(!this.hidden){return this}this.container.setStyle("display","block").setStyle("z-index",this.zIndex++);this.position();if(Browser.ie6&&this.options.useIframeShim){new Element("iframe",{frameborder:0,src:"about:blank",style:"position:absolute;z-index:-1;border:0 none;filter:alpha(opacity=0);top:"+(-this.container.getPatch().y||0)+"px;left:"+(-this.container.getPatch().x||0)+"px;width:"+(this.container.getSize().x||0)+"px;height:"+(this.container.getSize().y||0)+"px;"}).inject(this.container)}var a=this.options.effect;if(a){if(a===true||a.style==="opacity"){this.container.setStyle("opacity",a.from||0).setStyle("visibility","visible")}new Fx.Tween(this.container,{duration:a.duration||400,onComplete:function(){this.container.focus()}.bind(this)}).start(a.style||"opacity",a.from||0,a.to||1)}else{this.container.focus()}this.hidden=false;this.fireEvent("show",this);this.mask&&this.mask.show();if(this.options.autoHide){this.container.timer=this.hide.delay(this.options.autoHide.toInt()*1000,this)}return this},hide:function(){if(this.hidden){return this}var b=this.container.retrieve("resize_position");b&&window.removeEvent("resize",b);this.fireEvent("close",this);this.options.pins&&this.container.pin(false,false,false);var a=this.options.effect;if(this.options.single){if(a){this.stopTimer().container.setStyles({display:"none",opacity:0,visibility:"hidden"})}else{this.container.setStyle("display","none")}}else{if(a){this.container.timer=new Fx.Tween(this.container,{duration:a.duration||400,link:"ignore",onComplete:function(){this.container.destroy()}.bind(this)}).start(a.style||"opacity",a.to||1,a.from||0)}else{this.container.destroy()}document.id(this.container).eliminate("instance")}this.hidden=true;this.container.store("instance",this);return this.hideMask()},stopTimer:function(){if(this.container.timer){clearTimeout(this.container.timer);this.container.timer=null}return this},hideMask:function(){if(this.options.modal&&$$("[data-single]").retrieve("instance").every(function(a){return !a||!a.close.length||a.hidden})){this.mask.hide()}return this},hideAll:function(){this.hide();var a=$$("[data-single]").retrieve("instance");a.length&&a.each(function(b){b&&b.hide()})},position:function(){var a=this.options,b;if(!this.size.x&&Browser.ie&&Browser.version<8&&this.container.getSize().x>=this.doc.getSize().x){document.id(this.body).setStyle("width",a.minWidth.toInt()-this.container.getPatch().x)}if(!this.size.y&&Browser.ie&&Browser.version<8&&this.container.getSize().y>=this.doc.getSize().y){document.id(this.body).setStyle("height",Math.min(a.minHeight.toInt(),this.doc.getSize().y)-this.container.getPatch().y)}if(this.size.y){b=this.container}else{if(this.container.getSize().y>=this.doc.getSize().y){b=this.doc}}if(typeOf(b)==="element"){this.setHeight(b)}this.container.position(a.position);a.pins&&this.container.pin();return this},setHeight:function(a){a=a||this.container;this.content.setStyle("height",(!this.size.y&&Browser.ie&&Browser.version<8?this.body.getStyle("height").toInt():a.getSize().y-this.container.getPatch().y)-document.id(this.body).getPatch().y-document.id(this.header).getOuterSize().y-this.content.getPatch().y)},setTitle:function(a){this.title.set("html",a)},requestCache:function(b){var a;if(!b){return null}if(b.target&&b.cache){a=b.target.retrieve("request:cache");if(a){return a.success(a.response.text)}}a=new Request.HTML(b).send();b.target&&b.target.store("request:cache",a);return this},toElement:function(){return this.container}});Element.implement({fixed:function(f){f=[f].flatten()||["top","left"];var e=f.contains("left");var c=f.contains("top");if(!Browser.ie6){return}var b=window.getScroll();var a={x:this.getPosition().x-b.x,y:this.getPosition().y-b.y};var d=function(){if(e&&this.getStyle("left").toInt()>=document.body.clientWidth||c&&this.getStyle("top").toInt()>=document.body.clientHeight){return}b=window.getScroll();this.set("morph",{duration:200,transition:Fx.Transitions.Quart.easeOut}).morph({left:e?a.x+b.x:null,top:c?a.y+b.y:null})}.bind(this);window.addEvent("scroll",d)},pin:function(e,b,f,h){if(typeOf(e)==="object"){h=e.pos;f=e.restore;b=e.forceScroll;e=e.enable}h=h?[h].flatten():["top","left","bottom","right"];var j=h.contains("left");if(e!==false){if(!this.retrieve("pin:_pinned")){var i=window.getScroll();this.store("pin:_original",this.getStyles("position",h));var g=this.getPosition(!Browser.ie6?document.body:this.getOffsetParent());var c={left:j?g.x-i.x:"",top:g.y-i.y};if(!Browser.ie6){this.setStyle("position","fixed").setStyles(c)}else{if(!!b){this.setPosition({x:this.getOffsets().x+i.x,y:this.getOffsets().y+i.y})}if(this.getStyle("position")=="static"){this.setStyle("position","absolute")}var d={x:this.getPosition().x-i.x,y:this.getPosition().y-i.y};var a=function(){if(!this.retrieve("pin:_pinned")||j&&this.getStyle("left").toInt()>=document.body.clientWidth||this.getStyle("top").toInt()>=document.body.clientHeight){return}var k=window.getScroll();this.setStyles({left:j?d.x+k.x:"",top:d.y+k.y})}.bind(this);this.store("pin:_scrollFixer",a);window.addEvent("scroll",a)}this.store("pin:_pinned",true)}}else{if(!this.retrieve("pin:_pinned")){return this}if(!!f){this.setStyles(this.retrieve("pin:_original",{}))}this.eliminate("pin:_original");this.store("pin:_pinned",false);if(Browser.ie6){window.removeEvent("scroll",this.retrieve("pin:_scrollFixer"));this.eliminate("pin:_scrollFixer")}}return this},togglePin:function(){return this.pin(!this.retrieve("pin:_pinned"))}});var Mask=new Class({Implements:[Options,Events],options:{"class":"mask",effect:{style:"opacity",duration:300,from:0,to:0.7}},initialize:function(a){this.target=(a&&document.id(a.target))||document.id(document.body);this.setOptions(a);this.element=$$("div[rel=mask]."+this.options["class"])[0]||new Element("div[rel=mask]."+this.options["class"]).inject(this.options.injectTo||(this.target==window?document.body:this.target));if(this.options.html){this.element.set("html",this.options.html.stripScripts())}this.hidden=true},setSize:function(){if(!this.target||!document.id(this.element).isVisible()){return}this.element.setStyles({width:this.options.width||Math.max(this.target.getScrollSize().x,this.target.getSize().x,this.target.clientWidth||0),height:this.options.height||Math.max(this.target.getScrollSize().y,this.target.getSize().y,this.target.clientHeight||0)})},position:function(){this.element.position({target:this.target,resize:this.options.resize})},show:function(){if(!this.hidden){return}if(this.target==window){document.html.setStyles({height:"100%",overflow:"hidden"})}window.addEvent("resize",this.setSize.bind(this));this.setSize();this.element.setStyle("display","block");if(this.options.zIndex){this.element.setStyle("z-index",this.options.zIndex)}if(this.options.html){this.element.setStyle("line-height",this.element.getSize().y)}if(this.options.position){this.position()}if(this.options.pins){this.element.pin()}var a=this.options.effect;if(a){if(a===true||a.style=="opacity"){this.element.setStyle("opacity",a.from||0).setStyle("visibility","visible")}new Fx.Tween(this.element,{duration:a.duration||400}).start(a.style||"opacity",a.from||0,a.to)}else{if(this.element.get("opacity")===0){this.element.set("opacity","").setStyle("visibility","")}}this.hidden=false;return this},hide:function(){if(this.hidden){return}window.removeEvent("resize",this.setSize.bind(this));var b=this.element.retrieve("resize_position");b&&window.removeEvent("resize",b);var a=this.options.effect;if(a){new Fx.Tween(this.element,{duration:a.duration||400,onComplete:function(){this.element.destroy()}.bind(this)}).start(a.style||"opacity",a.to,a.from||0)}else{this.element.destroy()}if(this.target==window){document.html.setStyles({height:"",overflow:""})}this.hidden=true;return this},toggle:function(){return this[this.hidden?"show":"hide"]()},toElement:function(){return this.element}});Element.Properties.mask={set:function(b){var a=this.retrieve("mask");if(a){var c=document.id(a.element);c&&c.destroy();this.eliminate("mask")}return this.store("mask:options",b)},get:function(){var a=this.retrieve("mask");if(!a){a=new Mask(Object.merge(this.retrieve("mask:options")||{},{target:this}));this.store("mask",a)}return a}};Element.implement({mask:function(a){if(a){this.set("mask",a)}this.get("mask").show();return this},unmask:function(){this.get("mask").hide();return this}});var Dialog=new Class({Extends:Popup,initialize:function(b,a){a=Object.merge({width:330,useIframeShim:true,template:document.id("popup_template"),position:{intoView:true}},a||{});this.parent(b,a)}}).extend({instance:function(b,a){return new Dialog(b,Object.merge({show:false},a||{}))},alert:function(){var b=Array.from(arguments).link({msg:Type.isString,callback:Type.isFunction,options:Type.isObject});var a=b.options||{};var c='<div class="pop-attention-main"><div class="figure"><dfn class="alert">!</dfn><span class="mark">'+b.msg+'</span></div><div class="bottom"><a href="javascript:void(0);" class="btn btn-caution action-confirm">'+(a.confirmText||"确定")+"</a> </div></div>";Dialog.instance(new Element("div",{html:c}),Object.merge({width:350,title:"友情提示",modal:window,pins:true,single:false,effect:false,position:{intoView:true},component:{container:"alert-container",header:"alert-header",close:"alert-btn-close",body:"alert-body",content:"alert-content"},onLoad:function(){this.content.getElements(".action-confirm").addEvent("click",function(d){this.hide();b.callback&&b.callback.call(this)}.bind(this))}},a)).show()},confirm:function(){var b=Array.from(arguments).link({msg:Type.isString,callback:Type.isFunction,options:Type.isObject});var a=b.options||{};var c='<div class="pop-attention-main"><div class="figure"><dfn class="confirm">!</dfn><span class="mark">'+b.msg+'</span></div><div class="bottom"><a href="javascript:void(0);" class="btn btn-caution btn-pl4 action-confirm" data-return="1">'+(a.confirmText||"确定")+'</a><a  href="javascript:void(0);" class="btn  btn-cancel action-cancel btn-pl4" data-return="0">'+(a.cancelText||"取消")+"</a></div></div>";Dialog.instance(new Element("div",{html:c}),Object.merge({width:350,title:"友情提示",modal:window,pins:true,single:false,effect:false,position:{intoView:true},component:{container:"alert-container",header:"alert-header",close:"alert-btn-close",body:"alert-body",content:"alert-content"},onLoad:function(){var e=this,d;this.content.getElements("[data-return]").addEvent("click",function(f){d=!!this.get("data-return").toInt();e.hide();if(!!d){b.callback&&b.callback.call(this,d)}})}},a)).show()},tips:function(){var b=Array.from(arguments).link({element:Type.isElement,msg:Type.isString,callback:Type.isFunction,options:Type.isObject});var a=b.options||{};var d=document.id(b.element);var e='<div class="{body}"><div class="{content}">{main}</div></div>';var c='<span class="icon">&#x24;</span><p>'+b.msg+'</p><div class="bottom"><a href="javascript:void(0);" class="btn btn-black btn-small action-confirm" data-return="1">'+(a.confirmText||"确定")+'</a><a  class="btn btn-cancel btn-small action-cancel" href="javascript:void(0);" data-return="0">'+(a.cancelText||"取消")+"</a></div>";Dialog.instance(new Element("div",{html:c}),Object.merge({width:"",modal:false,template:e,single:true,effect:false,position:{target:d,from:{x:"c",y:"b"},to:{x:"c",y:"t"},offset:{x:0,y:-2},intoView:true,resize:true},component:{container:"dialog-tips-container",body:"dialog-tips-body",content:"dialog-tips-content"},onLoad:function(){var g=this,f;this.content.getElements("[data-return]").removeEvents("click").addEvent("click",function(h){f=!!this.get("data-return").toInt();b.callback&&b.callback.call(this,f);g.hide()});this.arrow=Arrow(this.container,{to:this.options.position.from});this.options.position.offset=this.arrow.setTargetOffset(this.options.position);this.options.eventTarget&&this.container.addEvent("outerclick",function(h){if(h.target!=this.options.eventTarget){this.hide()}}.bind(this))},onShow:function(){this.arrow.show()},onClose:function(){this.container.removeEvents("outerclick")}},a)).show()},iframe:function(b,a){return Dialog.instance(b,Object.merge({async:"iframe"},a||{})).show()},ajax:function(b,a){return Dialog.instance(b,Object.merge({async:"ajax"},a||{})).show()},image:function(b,a){return Dialog.instance(new Element("div",{html:'<img src="'+b+'" />'}),Object.merge({template:'<div class="{body}"><span><button type="button" class="{close}" title="关闭"><i>×</i></button></span><div class="{content}">{main}</div></div>',width:"",height:"",modal:true,single:true,component:{container:"image-container",close:"image-btn-close",content:"image-content"}},a||{})).show()}});var popTip=new Class({Extends:Popup,initialize:function(b,i){if(!b){return}i=i||{};var e=new Element("div[html="+b+"]");var a=i.relative||document.body,h=(/^(?:body|html)$/i).test(a.tagName.toLowerCase()),g=h?"center":0,f=h?0:"top",c=!!h,d=h?0:"bottom";this.options=Object.merge(this.options,{type:i.type||"nofoot",template:i.template||document.id("xtip_template"),modal:false,pins:c,single:false,effect:true,position:{target:a,from:{x:0,y:d},to:{x:g,y:f},offset:{x:i.offset&&i.offset.x?i.offset.x:0,y:i.offset&&i.offset.y?i.offset.y:0},intoView:i.intoView!==undefined?i.intoView:true},component:{container:"xtip-container",body:"xtip-body",header:"xtip-header",close:"xtip-btn-close",content:"xtip-content"}});this.parent(e,i)}});var Tips=new Class({Implements:Options,options:{type:"autohide",offset:{x:0,y:-9},hideDelay:2000,position:"topCenter",inject:document.body,where:"bottom","class":"xtips-container",arrow:true,text:null},initialize:function(){var b=Array.from(arguments).link({element:Type.isElement,msg:Type.isString,options:Type.isObject});var a=this.elements=document.id(b.element)||$$("[data-tips]");if(!a||typeOf(a)==="elements"&&!a.length){return null}this.setOptions(b.options);this.options.inject=this.options.inject||document.body;this.build(b.msg)},build:function(c){var a=this.options.type=="inline"?"span":"div";var b="<"+a+' class="xtips-content"></'+a+">";this.container=document.id("xtips_container")||new Element(a+"#xtips_container."+this.options["class"],{html:b}).inject(this.options.type=="inline"&&typeOf(this.elements=="element")?this.elements:document.id(this.options.inject),this.options.where).store("tips",this);this.content=this.container.getElement(".xtips-content");this.msg=c||"";return this},attach:function(a){if(a=="mouse"){Array.from(this.elements).each(function(b){b.addEvents({mouseenter:this.show.bind(this,[b,this.msg,false]),mouseleave:this.hide.bind(this)})})}else{if(a=="click"){Array.from(this.elements).each(function(b){b.addEvent("click",function(){this.hidden?this.show(b,this.msg):this.hide()})})}}return this},show:function(d,b,f){f=f||this.options.type;if(!b&&typeOf(this.elements)==="element"){b=this.elements}var h=d||this.msg||b.get("data-tips")||b.retrieve("tips:text");if(!b||!h||!this.container){return this}if(this.options.type!=="tooltip"){h='<q class="icon">&#x24;</q>'+h}this.content.set("html",h);var g=this.options.position.toLowerCase();var e=b.getPosition();var j=this.container.getSize();var i=b.getSize();var c=b.get("data-tips-config");c=JSON.decode(c)||{};var a={};if(this.options.type!=="inline"){if(["rightcenter","rc","cr"].indexOf(g)!=-1){a={left:e.x+i.x,top:Math.max(e.y+(j.y-i.y)/2,0)}}else{if(["topcenter","tc","ct"].indexOf(g)!=-1){a={left:Math.max(e.x-(j.x-i.x)/2+this.options.offset.x||0,0),top:Math.max(e.y-j.y+this.options.offset.y||0,0)}}else{if(["bottomleft","bl","lb"].indexOf(g)!=-1){a={left:Math.max(e.x||0,0),top:Math.max(e.y+i.y+this.options.offset.y||0,0)}}}}}a=Object.merge({display:"",opacity:1,visibility:"visible",width:c.width?c.width:j.x>window.getSize().x?window.getSize().x:""},a);this.container.setStyles(a);if(this.options.arrow){g={topCenter:{x:"b",y:"c"},rightCenter:{x:"l",y:"c"},bottomCenter:{x:"t",y:"c"},leftCenter:{x:"r",y:"c"}};Arrow(this.container,{to:g[this.options.position]}).show()}this.hidden=false;if(f=="autohide"){this.stopTimer(b);b.timer=this.hide.delay(this.options.hideDelay,this)}return this},stopTimer:function(a){if(a.timer){clearTimeout(a.timer);a.timer=null}return this},hide:function(){this.container.setStyle("opacity",0).setStyle("visibility","hidden");this.hidden=true;return this}});Element.implement({tips:function(b,a){new Tips(this).show(b,this,a);return this}});var Warn=function(b,c,a){b=document.id(b);if(!b){return}this.msg=c||"";a=a||"warn-message";this.container=document.id("warn_message")?document.id("warn_message").set("html",this.msg):new Element("span#warn_message."+a,{html:this.msg}).inject(b,"after")};Warn.prototype.show=function(a){this.container.set("html",a||this.msg||"").show("block")};Warn.prototype.hide=function(){this.container.hide()};var ToolTip=new Class({Implements:[Events,Options],Binds:["hide"],timer:null,options:{autohide:true,offset:12,hideDelay:1000,"class":"tooltip",arrow:"arrow",position:{from:"cb",to:"ct",offset:{x:0,y:-2}},text:null},initialize:function(b,a){this.element=b;this.setOptions(a);this.toolTip=new Element("div."+this.options["class"]+"-container",{html:'<div class="'+this.options["class"]+'-content">'+this.options.text+"</div>"}).hide().inject(document.body);this.content=this.toolTip.getElement("."+this.options["class"]+"-content");if(this.options.arrow){this.arrow=Arrow(this.toolTip,{"class":this.options.arrow,to:this.options.position.from});this.options.position.offset=this.arrow.setTargetOffset(this.options.position)}[this.element,this.toolTip].each(function(c){c.addEvents({mouseenter:function(){if(this.options.autohide){window.clearTimeout(this.timer)}}.bind(this),mouseleave:function(){if(this.options.autohide){this.timer=this.hide.delay(this.options.hideDelay,this)}}.bind(this)})},this)},hide:function(){var a;this.toolTip.hide();if(typeOf(a=this.toolTip.getElement("div.close"))=="element"){a.destroy()}this.fireEvent("hide");this.element.erase("data-tooltip-displayed");return this},position:function(){this.toolTip.position(Object.merge(this.options.position,{target:this.element}));return this},set:function(a){if(typeOf(a)=="element"){this.content.empty().grab(a)}else{this.content.set("html",a)}if(!this.options.autohide){new Element('div.close[title="关闭"]').inject(this.toolTip,"top").addEvent("click",this.hide.bind(this))}},show:function(){if(!this.element.get("data-tooltip-displayed")){this.element.set("data-tooltip-displayed",true);this.toolTip.show();this.position();this.arrow&&this.arrow.show();this.fireEvent("show")}return this}}).extend({instance:function(){var e;var b;var c=arguments[0],f=["string","element"].contains(typeOf(arguments[1])),d=f?arguments[1]:(arguments[2]||null),a=f?(arguments[2]||{}):arguments[1];if(typeOf(e=document.retrieve("ToolTip.current"))=="object"){e.hide()}if((b=c.retrieve("ToolTip.instance"))==null){b=new ToolTip(c,a)}else{b.setOptions(a)}c.store("ToolTip.instance",b);document.store("ToolTip.current",b);if(d){b.set(d)}return b}});var Arrow=function(d,c){c=Object.merge({target:document.body,"class":"arrow",to:"bc",offset:{x:0,y:0}},c||{});if(typeOf(d)=="element"){c.target=d}var b=typeof c["class"]=="string"?c["class"]:"arrow";var e={b:b+"-bottom",t:b+"-top",l:b+"-left",r:b+"-right"};c.position=Arrow.getCoordinate(c.to);var a=new Element("div."+b+"."+e[c.position.x],{html:'<i class="below">◆</i><i class="above">◆</i>'}).inject(c.target).store("Arrow:position",c);a.show=function(){this.setStyle("display","").position(c);return this};a.position=function(){var j,n;var g=["string","element"].contains(typeOf(arguments[0]));if(g){j=document.id(arguments[0]);n=arguments[1]}else{n=arguments[0];j=document.id(n.target)}if(!j){return}n=Object.merge({to:"bc",offset:{x:0,y:0}},n||this.retrieve("Arrow:position",{}));var f={c:{x:0.5},m:{y:0.5},r:{x:1},b:{y:1}};var m=j.getSize();var h=j.getPatch("border");var l=this.getSize();var i=n.position||Arrow.getCoordinate(n.to);var k={left:f[i.y].x?(m.x-l.x-h.x)*f[i.y].x+n.offset.x:"",top:f[i.y].y?(m.y-l.y-h.y)*f[i.y].y+n.offset.y:""};return this.setStyles(k)};a.setTargetOffset=function(h,g){if(typeof h=="object"&&h.to&&h.offset){g=h.offset;h=h.to}else{g=g||{x:0,y:0}}h=Arrow.getCoordinate(h);var f={t:["y",-1,"bottom"],b:["y",1,"top"],l:["x",-1,"right"],r:["x",1,"left"]};g[f[h.x][0]]+=f[h.x][1]*this.getElement(".below").getStyle("border-"+f[h.x][2]+"-width").toInt();return g};return a}.extend({getCoordinate:function(f){if(typeof f=="object"&&(f.x||f.x===0)&&(f.y||f.y===0)){if("ltbr".indexOf(f.x)>-1&&"ltbrcm".indexOf(f.y)>-1){return f}if("cm".indexOf(f.x)>-1){return{x:f.y,y:f.x}}f=f.x.toString()+f.y.toString()}f=f.toLowerCase();var e=f.match(/^c(enter)?|^m(iddle)?/g);var d=f.match(/c(enter)?$|m(iddle)?$/g);var g;if(e||d){g=f.split(e?e[0]:d[0])[e?1:0];f=g+(g.test(/^l(eft)?|^r(ight)?/g)?"m":"c")}return{x:f.test(/^l(eft)?|^0/)?"l":f.test(/^r(ight)?|^1(00%)?/)?"r":f.test(/^t(op)?/)?"t":"b",y:f.test(/l(eft)?$/)?"l":f.test(/r(ight)?$/)?"r":f.test(/t(op)?$|0$/)?"t":f.test(/b(ottom)?$|1(00%)?$/)?"b":f.test(/m(iddle)?$/)?"m":"c"}}});function Message(a,c,b,i,g){if(!a){return null}if(!isNaN(c)){b=c;c="show"}else{if(typeOf(b)==="function"){i=b;b=3}else{c=c||"show";b=!isNaN(b)?b:3}}var d={show:"",success:"&#x25;",error:"#"};var e={container:"message-"+c,body:"message-body",content:"message-content",icon:d[c]};var h=document.id("pop_message_"+c);var f;if(h){f=h.retrieve("instance");if(f){f.content.innerHTML=a;f.show()}}new Popup(new Element("div[html="+a+"]"),{id:"pop_message_"+c,type:"nohead",template:g||document.id("message_template"),modal:false,pins:true,single:true,effect:true,autoHide:b,component:e,onShow:function(){this.stopTimer()},onClose:typeOf(i)==="function"?i.bind(this):null});return(c=="error"?false:true)}Message.show=function(b,a,c){Message(b||LANG_jstools.messageShow,"show",a,c);return this};Message.hide=function(a){a=a||"show";document.id("pop_message_"+a)&&document.id("pop_message_"+a).retrieve("instance").hide()};Message.error=function(b,a,c){return Message(b||LANG_jstools.messageError,"error",a,c)};Message.success=function(b,a,c){return Message(b||LANG_jstools.messageSuccess,"success",a,c)};function maxZindex(d,g){d=d||"div";d=$$(d);var a=0;if(d.length){var f=d.filter(function(h){if(h.nodeType!=1||["script","link","base","style"].contains(h.tagName.toLowerCase())){return}return["absolute","relative","fixed"].contains(h.getStyle("position"))});if(f.length){for(var c=0,b=f.length;c<b;c++){var e=f[c].getStyle("z-index");a=Math.max(a,isNaN(e)?0:e)}}}if(g){a+=parseInt(g)}return Math.min(a,2147483647)};