<footer class="footer">
    <div class="container_footer footer-ul">
        <{$showData}>
        <div class="clearfix"></div>
    </div>
</footer>

<script src="https://g.alicdn.com/dingding/dingtalk-jsapi/2.10.3/dingtalk.open.js"></script>
<script type="text/javascript">
    (function($){
        function MiniCarWidgets(){
            this.register_ids = Array();
            this.open_by_action = false;

            this.request_mini_cart = function(){
                var mini_cart = this;
                //发ajax请求至后端请求mini购物车数据
                var requestURL = "<{link app=b2c ctl='site_cart' act='view'}>";
                var postData = "mini_cart_list:true";
                $.ajax({
                    url: requestURL,
                    type: "POST",
                    dataType: "html",
                    data: "",
                    success : function (data) {
                        mini_cart.updateCart(data);
                        mini_cart.sync();
                        mini_cart.attach();
                    },
                    error : function() {
                        return false;
                    }
                });
            }

            this.autoOpenCart = function(timeout){
                if(this.open_by_action){
                    return;
                }

                var mini_cart = this;
                mini_cart.openCart();
                mini_cart.request_mini_cart();
                setTimeout(function(){
                    if(mini_cart.open_by_action == false){
                        mini_cart.closeCart();
                    }
                },timeout);
            }

            this.openCart = function(){
                var div = $('.cart-out');
                div.addClass('hover');
            }

            this.closeCart = function(){
                var div = $('.cart-out');
                div.removeClass('hover');
            }

            this.updateCart = function(data){
                $(".cart-div").html(data);
            }



            this.init = function(){
                var mini_cart = this;
                // var b = $('.userBar-out').width();
                // $('.userBar-div').width(b-2);

                mini_cart.sync();
            }

            this.register = function($id){
                this.register_ids.push($id);
            }

            this.sync = function(){
                var cart_count_value = 0;
                if ( $.cookie('S[CART_COUNT]')!=null &&  $.cookie('S[CART_COUNT]') > 0 )  {
                    cart_count_value = $.cookie('S[CART_COUNT]');
                }

                for(var i=0; i<this.register_ids.length;i++){
                    $('#'+this.register_ids[i]).text(cart_count_value);
                }
            }

            this.attach = function(){
                var mini_cart = this;
                $(".cart-price .cart-remove").click(function(){
                    var removeRequest = "";
                    var dataInfo = $(this).parent().siblings("div.cart-info").children("span");
                    for(i =0 ; i < dataInfo.length; i++){
                        removeRequest += $(dataInfo[i]).attr('name') + "=" + $(dataInfo[i]).text() + "&";
                    }
                    removeRequest += "response_json=true";


                    //发ajax请求至后端请求mini购物车数据
                    var requestURL = "<{link app=b2c ctl='site_cart' act='remove'}>";
                    var postData = removeRequest;
                    $.ajax({
                        url: requestURL,
                        type: "POST",
                        dataType: "json",
                        data: postData,
                        success : function (data) {
                            mini_cart.request_mini_cart();
                        },
                        error : function() {
                            return false;
                        }
                    });

                });
            }
        }


        gMiniCart = new MiniCarWidgets;

        window.onload = function(){
            gMiniCart.init();
            gMiniCart.register('mini_cart_item_count');
            gMiniCart.sync();
            gMiniCart.request_mini_cart();
        }
        if (dd && dd.env && dd.env.platform!=="notInDingTalk") {
            dd.ready(function() {
                if(dd.env.platform=='pc'){
                    $('a').each(function(index,item){
                        var _target = $(item).attr('target');
                        if(_target && _target== '_blank') {
                            $(item).attr('target','_self')
                        }
                    })
                    $('a').on('click',function(){
                        var _target = $(this).attr('target')
                        if(_target && _target== '_blank') {
                            $(this).attr('target','_self')
                        }
                    })
                }

            });
        }
    })(jQuery);
</script>
<script type="text/javascript">
    var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F0170dd4f0e0d7a754000f090049d89a7' type='text/javascript'%3E%3C/script%3E"));
</script>