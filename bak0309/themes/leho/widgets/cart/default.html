<li class="f16" id="my_like_<{$widgets_id}>">
    <{if $env.session.account.member}>
    <a class="header-r-fav" href="<{link app=b2c ctl=site_share act=like}>"><s></s><strong class="header-like-text"></strong></a>
     <{else}>
    <a class="header-r-fav login-link" href="<{link app=b2c ctl=site_passport act=login}>"><s></s><strong class="header-like-text"></strong></a>
    <{/if}>
</li>
<li ><a class="header-r-shopcart" id="minicart_<{$widgets_id}>" href="<{link app=b2c ctl=site_cart act=index}>">
    
    <s></s>
<strong class="top-mini-cart-txt"></strong></a>
<!--mini 购物车 start 默认display:none;请开发控制其属性-->
<div class="header-shopcart-bd-box" >
	<div class="mini-cart-ready">
		<s class="arrow"></s>

		<div class="mini-cart-body">
		</div>
	</div>
</div>
</li>
<!--mini 购物车 end-->

<!--<div class="minicart<{if $setting.show_minicart}> has-minicart<{/if}>" id="minicart_<{$widgets_id}>">-->
  <!--<{if $setting.show_minicart}>-->
  <!--<a href="<{link app=b2c ctl=site_cart act=index}>" class="minicart-text">-->
    <!--<i class="icon">&#x3e;</i> <{t app='b2c'}>购物车中有<{/t}>-->
    <!--<{if $setting.cart_show_type==1}><b class="op-cart-number">0</b> <{t app='b2c'}>件<{/t}><{else}><b class="op-cart-count">0</b> <{t app='b2c'}>种<{/t}><{/if}><{t app='b2c'}>商品<{/t}>-->
  <!--</a>-->
  <!--<div class="minicart-cont">-->
  <!--</div>-->
  <!--<{else}>-->
  <!--<span class="minicart-text">-->
    <!--<i class="icon">&#x3e;</i> <{t app='b2c'}>购物车中有<{/t}>-->
    <!--<{if $setting.cart_show_type==1}><b class="op-cart-number">0</b> <{t app='b2c'}>件<{/t}><{else}><b class="op-cart-count">0</b> <{t app='b2c'}>种<{/t}><{/if}><{t app='b2c'}>商品<{/t}>-->
  <!--</span>-->
  <!--<a href="<{link app=b2c ctl=site_cart act=index}>" class="btn btn-tocart"><{t app='b2c'}>去结算<{/t}></a>-->
  <!--<{/if}>-->
<!--</div>-->

<script>
window.addEvent('domready',function(){
    updateCartInfo();

    <{if $setting.show_minicart}>
    if ( Cookie.read('S[CART_NUMBER]')==null||Cookie.read('S[CART_NUMBER]')==0)  {
        $('minicart_<{$widgets_id}>').getElement('.top-mini-cart-txt').innerHTML = 0 ;
    }else{
        $('minicart_<{$widgets_id}>').getElement('.top-mini-cart-txt').innerHTML = Cookie.read('S[CART_NUMBER]');
    }

    if ( Cookie.read('S[LIKE_COUNT]')==null||Cookie.read('S[LIKE_COUNT]')==0)  {
        $('my_like_<{$widgets_id}>').getElement('.header-like-text').innerHTML = 0 ;
    }else{
        $('my_like_<{$widgets_id}>').getElement('.header-like-text').innerHTML = Cookie.read('S[LIKE_COUNT]');
    }
	
    var cartViewUrl='<{link app=b2c ctl=site_cart act=view}>';
    var MiniCarWidgets={
        init:function(){
            var minicart=this.cart= $('minicart_<{$widgets_id}>');
			var minicart_body = this.minicart_body = $$('.header-shopcart-bd-box')[0];
            this.detailbox=minicart_body.getElement('.mini-cart-body');
      //      this.detailbox.fade(0);
            this.handle=minicart;
            this.attach();
        },
        attach:function(){
            this.handle.addEvents({
                'mouseenter':function(e){
                    if(e&&this.state) return;
                    this.show();
                    this.request({
                        url:cartViewUrl,
                        params:e,
                        method:'post',
                        onRequest:function(){
							 if ( (Cookie.read('S[CART_NUMBER]') == 0||Cookie.read('S[CART_NUMBER]')==null) ) {
        $('minicart_<{$widgets_id}>').getElement('.top-mini-cart-txt').innerHTML = '&nbsp;';
    }else{
        $('minicart_<{$widgets_id}>').getElement('.top-mini-cart-txt').innerHTML = Cookie.read('S[CART_NUMBER]');
    }
                            this.detailbox.innerHTML='<div class="mini-cart-bd" style="width:100px;text-align:center;">加载中...</div>';
                        }.bind(this)
                    });


                if(window.ie7){
                 ['.product-album-preview','.product-album-pic','.album-preview-container'].each(function(cls){

                    var el = document.getElement(cls);
                    el && el.setStyle('position','static');
                 });

                }
                }.bind(this)
            });

            this.handle.getParent().addEvents({
            'mouseleave':function(e){

                if(window.ie7){
                 (function(){
                     ['.product-album-preview','.product-album-pic','.album-preview-container'].each(function(cls){
                        var el = document.getElement(cls);
                        el && el.setStyle('position','relative');
                     });
                 }).delay(500,this);

                }
                this.hide.delay(500,this);
                }.bind(this)
            });
            this.cart.addEvent('_show',function(e){
                this.handle.fireEvent('mouseenter',[e]);
            }.bind(this));
        },
        show:function(e){
            //this.detailbox.fade(1);
            this.minicart_body.addClass('minicart-active');
            this.state=true;
            var self = this;
            /*
            $(document.body).addEvent('click',function(){
                self.hide();
                this.removeEvent('click',arguments.callee);
            });
           */
            return this;
        },
        hide:function(){
            //this.detailbox.fade(0);
            this.minicart_body.removeClass('minicart-active');
            this.state=false;
        },
        setHeight: function(el) {
 return this;
            var h = window.getSize().y - this.detailbox.getPosition(document.body).y + window.getScroll().y - this.detailbox.getPatch().y;
            console.info(this.detailbox.className);
            var dh = this.detailbox.getSize().y - this.detailbox.getPatch('padding', 'border').y;
            if(dh >= h){
                //this.detailbox.setStyle('height',h);
            }
            else this.detailbox.setStyle('height', 'auto');
            return this;
        },
        /*removeCart:function(el){
            this.request({
                url:el.href,
                data:el.getParent('.goods-item')
            });
        },*/
        addEvent:function(){
            var _this=this;
            this.detailbox.getElements('.action-delete').addEvent('click',function(e){
                e.stop();
                _this.removeCart(this);
            });
        },
        fade:function(el){ 
            //(function(){el.setStyle('opacity',0).fade('in');}).delay(800);
            el.setStyle('opacity',0).set('tween',{duration: 'long'}).tween('opacity', 1);
        },
        request:function(options){
            options = options || {};
            options.data = (options.data?options.data.toQueryString():'')+'&mini_cart_list=true';
            options = Object.merge({
                method:'post',
                update: this.detailbox,
                onSuccess:function(re){
                    try{
                        updateCartInfo();
                        fixImageSize($$('img[data-img-zoom]'));

                    }catch(e){}

                var param = options.params;

                var item = this.minicart_body.getElements('.mini-cart-bd li');
                if(param && param=='addcart') this.fade(item[0]);

                    this.setHeight().addEvent();
                }.bind(this)
            },options);
            return new Request.HTML(options).send();
        }
    };
    MiniCarWidgets.init();
    <{/if}>
});
</script>
