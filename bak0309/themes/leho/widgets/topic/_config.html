<div id="cat-config" style="display:none;"></div>
	<div class="tableform widgetconfig">
	  <div class="division">
	  <table width="100%" border="0" cellspacing="0" cellpadding="0">
		  <tr>
			<th width="10%">显示分类：</th>
			<td width="90%">  
				<input name="limit" class="inputstyle" value="<{$setting.limit}>" vtype="required&&number"/>&nbsp;&nbsp;个
			</td>
		  </tr>
	  </table>
	</div>
	
	<div class="btn-add-button">
		<{button type="button" class="btn-add" label=$___b2c="添加"|t:'b2c'}>
	</div>
	
	<{if !$setting.top_cat || !$setting.top_cat.0.topic_cat_id || !$setting.top_cat.0.topic_logo || !$setting.top_cat.0.topic_desc || !$setting.top_cat.0.topic_url}>
	<div class="division">
		<table width="100%" border="0" cellspacing="0" cellpadding="0" class="advertisement-topic">
			<tr>
				<th><{t}>专题分类：<{/t}></th>
				<td>
					<{input type="select" name="top_cat[0][topic_cat_id]" options=$setting.topic_cat value=""}>
				</td>
			</tr>
			<tr>
				<th><{t}>图片：<{/t}></th>
				<td>
					<input name="top_cat[0][topic_logo]" class="imgsrc" value=""><input type="button" value="<{t app='b2c'}>上传图片<{/t}>" class="uploadbtn" onclick="addPic(this);" />
				</td>
			</tr>
			<tr>
				<th><{t}>文案：<{/t}></th>
				<td>
					<{input type="text" name="top_cat[0][topic_desc]" value=""}>
				</td>
			</tr>
			<tr>
				<th><{t}>链接：<{/t}></th>
				<td>
					<{input type="text" name="top_cat[0][topic_url]" value=""}>
				</td>
			</tr>
			<tr>
				<td colspan="2">
					<{button type="button" onclick="return _del_item(this);" label=$___b2c="删除"|t:'b2c'}>
				</td>
			</tr>
		</table>
	</div>
	<{else}>
	<{foreach from=$setting.top_cat item=item key=key}>
	<div class="division">
		<table width="100%" border="0" cellspacing="0" cellpadding="0" class="advertisement-topic">
			<tr>
				<th><{t}>专题分类：<{/t}></th>
				<td>
					<{input type="select" name="top_cat[{$key}][topic_cat_id]" options=$setting.topic_cat value=$item.topic_cat_id}>
				</td>
			</tr>
			<tr>
				<th><{t}>图片：<{/t}></th>
				<td>
					<input name="top_cat[<{$key}>][topic_logo]" class="imgsrc" value="<{$item.topic_logo}>"><input type="button" value="<{t app='b2c'}>上传图片<{/t}>" class="uploadbtn" onclick="addPic(this);" />
				</td>
			</tr>
			<tr>
				<th><{t}>文案：<{/t}></th>
				<td>
					<{input type="text" name="top_cat[{$key}][topic_desc]" value=$item.topic_desc}>
				</td>
			</tr>
			<tr>
				<th><{t}>链接：<{/t}></th>
				<td>
					<{input type="text" name="top_cat[{$key}][topic_url]" value=$item.topic_url}>
				</td>
			</tr>
			<tr>
				<td colspan="2">
					<{button type="button" onclick="return _del_item(this);" label=$___b2c="删除"|t:'b2c'}>
				</td>
			</tr>
		</table>
	</div>
	<{/foreach}>
	<{/if}>
	
	<div id="showchange" style="display:none;">
		<table width="100%" border="0" cellspacing="0" cellpadding="0" class="{class}">
			<tr>
				<th><{t}>专题分类：<{/t}></th>
				<td>
					<{input type="select" name="{name_cat_id}" options=$setting.topic_cat value=""}>
				</td>
			</tr>
			<tr>
				<th><{t}>图片：<{/t}></th>
				<td>
					<input name="{name_logo}" class="imgsrc" value=""><input type=button value="<{t app='b2c'}>上传图片<{/t}>" class="uploadbtn" onclick="addPic(this);" />
				</td>
			</tr>
			<tr>
				<th><{t}>文案：<{/t}></th>
				<td>
					<input type="text" name="{name_des}" value="" />
				</td>
			</tr>
			<tr>
				<th><{t}>链接：<{/t}></th>
				<td>
					<input type="text" name="{name_url}" value="" />
				</td>
			</tr>
			<tr>
				<td colspan="2">
					<{button type="button" onclick="return _del_item(this);" label=$___b2c="删除"|t:'b2c'}>
				</td>
			</tr>
		</table>
	</div>
</div>
<script>
	$$('.btn-add').addEvent('click',function(){
		var _insert_t = $$('.advertisement-topic').getLast();
		_insert_t = _insert_t?_insert_t.getParent('.division'):$$('.btn-add-button')[0];
		var _length  = $$('.advertisement-topic').length;
		
		var _change_h = $('showchange').innerHTML;
		var _obj = {'class':'advertisement-topic','name_cat_id':"top_cat["+_length+"][topic_cat_id]",'name_logo':"top_cat["+_length+"][topic_logo]",'name_des':"top_cat["+_length+"][topic_desc]",'name_url':"top_cat["+_length+"][topic_url]"};
		
		_change_h = _change_h.substitute(_obj);
		var _division = new Element('div',{'class':'division','html':_change_h});
		_division.inject(_insert_t,'after');
		
		return false;
	});
	
	var _del_item = function(e){
		var _target = $(e.target)||$(e);
		
		_target.getParent('.division').remove();
	};
	
	function addPic(e){
		var _target = $(e).getPrevious();
		var url='index.php?app=desktop&act=alertpages&goto='+encodeURIComponent("index.php?app=image&ctl=admin_manage&act=image_broswer&type=big");
		Ex_Loader('modedialog',function(){
			return new imgDialog(url,{onCallback:function(image_id,image_src){
					 _target.value=image_src;
			}})	;
		});
	}
</script>